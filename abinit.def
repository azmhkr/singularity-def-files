Bootstrap: docker
From: ubuntu:latest

%post
    apt-get update
    apt-get install -y wget build-essential
    apt-get install -y gfortran mpi-default-dev libopenmpi-dev liblapack-dev libblas-dev
    apt-get install -y libhdf5-dev libnetcdf-dev libnetcdff-dev libxc-dev
    apt-get install -y python3-dev python3-pip

    # install q-e
    wget https://www.abinit.org/sites/default/files/packages/abinit-9.0.4.tar.gz
    tar xzf abinit-9.0.4.tar.gz
    cd abinit-9.0.4
    mkdir build && cd build
    ../configure FC=mpifort --with-mpi="yes"
    make -j4
    make install

    # install python libraries
    cd /
    git clone https://gitlab.com/ase/ase.git
    cd ase
    pip install .
    pip install numpy scipy matplotlib pandas dftd3 dftd4

%environment
    export ASE_ABINIT_COMMAND="mpirun abinit < PREFIX.files > PREFIX.log"
    export ABINIT_PP_PATH=
